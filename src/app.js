let appState={studies:[],darkMode:!1,activeTaskId:null,timerInterval:null};function loadData(){const t=localStorage.getItem("eduGuideData");t&&(appState.studies=JSON.parse(t));const e=localStorage.getItem("darkMode");e&&(appState.darkMode=JSON.parse(e),applyDarkMode())}function saveData(){localStorage.setItem("eduGuideData",JSON.stringify(appState.studies))}function applyDarkMode(){appState.darkMode?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("darkMode",JSON.stringify(appState.darkMode))}function hideLoadingScreen(){setTimeout(()=>{const t=document.getElementById("loading-screen");t.classList.remove("loading-active"),t.classList.add("loading-inactive")},1500)}function renderHome(){const t=document.getElementById("content");document.getElementById("page-title").textContent="Study Plans",0===appState.studies.length?t.innerHTML='<div class="empty-state"><h2>No Study Plans Yet</h2><p>Create your first study plan by clicking the + button below</p></div>':t.innerHTML=appState.studies.map((e,n)=>{const o=e.completed?"‚úÖ Completed":"‚è≥ In Progress",s=e.completed?"completed":"";return`<div class="card ${s}"><h3 class="card-title">${e.title}</h3><p class="card-subtitle">${e.subject}</p><p>${e.description}</p><p class="card-meta"><span>Duration: ${e.duration} mins</span><span>${o}</span></p><div class="btn-group" style="margin-top: 12px;"><button class="btn btn-primary" onclick="startTask(${appState.studies.indexOf(e)}, event)" ${e.completed?"disabled":""}>${e.completed?"Completed":"Start"}</button><button class="btn btn-secondary" onclick="editStudy(${appState.studies.indexOf(e)}, event)">Edit</button><button class="btn btn-danger" onclick="deleteStudy(${appState.studies.indexOf(e)}, event)">Delete</button></div></div>`}).join("")}function renderCreate(){document.getElementById("page-title").textContent="Create Study Plan",document.getElementById("content").innerHTML='<form id="createForm"><div class="form-group"><label>Plan Title</label><input type="text" id="title" placeholder="e.g., Chapter 5 Review" required></div><div class="form-group"><label>Subject</label><input type="text" id="subject" placeholder="e.g., Mathematics" required></div><div class="form-group"><label>Description</label><textarea id="description" placeholder="What will you study?" required></textarea></div><div class="form-group"><label>Duration (minutes)</label><input type="number" id="duration" placeholder="30" min="5" required></div><button type="submit" class="btn btn-primary">Create Plan</button></form>',document.getElementById("createForm").addEventListener("submit",function(t){t.preventDefault();const e={id:Date.now(),title:document.getElementById("title").value,subject:document.getElementById("subject").value,description:document.getElementById("description").value,duration:document.getElementById("duration").value,createdAt:new Date().toISOString(),completed:!1,completedAt:null};appState.studies.push(e),saveData(),SoundSystem.playSuccessSound(),NotificationSystem.showSuccess('Study plan "'+e.title+'" created!'),setTimeout(()=>{switchPage("home")},500)})}function startTask(t,e){e&&e.stopPropagation();const o=appState.studies[t];appState.activeTaskId=o.id;let n=60*o.duration;let s=!1;const i=()=>{const t=Math.floor(n/60),e=n%60,a=(t.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0"));document.getElementById("timer-display").textContent=a,n<=0?(clearInterval(appState.timerInterval),completeTask(t)):n--};document.getElementById("page-title").textContent="Task in Progress",document.getElementById("content").innerHTML=`<div class="task-container"><h2 class="task-title">${o.title}</h2><p class="task-subject">üìö ${o.subject}</p><p class="task-description">${o.description}</p><div class="timer-box"><div class="timer-display" id="timer-display">00:00</div><p class="timer-label">Time Remaining</p></div><div class="task-controls"><button id="pausePlayBtn" class="btn btn-primary">‚è∏Ô∏è Pause</button><button onclick="stopTask()" class="btn btn-danger">Stop Task</button></div><div class="task-info"><p>üìù Focus on: ${o.subject}</p><p>üìÖ Started: ${new Date().toLocaleTimeString()}</p></div></div>`,i(),appState.timerInterval=setInterval(i,1e3),document.getElementById("pausePlayBtn").addEventListener("click",function(){if(s)appState.timerInterval=setInterval(i,1e3),this.textContent="‚è∏Ô∏è Pause",s=!1,SoundSystem.playButtonSound();else{clearInterval(appState.timerInterval);this.textContent="‚ñ∂Ô∏è Resume",s=!0,SoundSystem.playButtonSound()}})}function completeTask(t){const e=appState.studies[t];e.completed=!0,e.completedAt=new Date().toISOString(),saveData(),SoundSystem.playCompletionSound();const o=document.getElementById("content");o.innerHTML=`<div class="completion-container"><div class="completion-icon">üéâ</div><h2>Great Job!</h2><p class="completion-message">You've completed the task:</p><h3 class="task-name">${e.title}</h3><p class="completion-time">Completed at ${new Date().toLocaleTimeString()}</p></div>`,NotificationSystem.showTaskComplete(e.title),setTimeout(()=>{switchPage("home")},3e3)}function stopTask(){appState.timerInterval&&clearInterval(appState.timerInterval),SoundSystem.playButtonSound(),switchPage("home")}function editStudy(t,e){e&&e.stopPropagation();const o=appState.studies[t];document.getElementById("page-title").textContent="Edit Study Plan",document.getElementById("content").innerHTML=`<form id="editForm"><div class="form-group"><label>Plan Title</label><input type="text" id="title" value="${o.title}" required></div><div class="form-group"><label>Subject</label><input type="text" id="subject" value="${o.subject}" required></div><div class="form-group"><label>Description</label><textarea id="description" required>${o.description}</textarea></div><div class="form-group"><label>Duration (minutes)</label><input type="number" id="duration" value="${o.duration}" min="5" required></div><div class="btn-group"><button type="submit" class="btn btn-primary">Save Changes</button><button type="button" class="btn btn-secondary" onclick="renderHome()">Cancel</button></div></form>`,document.getElementById("editForm").addEventListener("submit",function(e){e.preventDefault(),appState.studies[t]={...appState.studies[t],title:document.getElementById("title").value,subject:document.getElementById("subject").value,description:document.getElementById("description").value,duration:document.getElementById("duration").value},saveData(),SoundSystem.playSuccessSound(),NotificationSystem.showSuccess("Study plan updated!"),setTimeout(()=>{renderHome()},500)})}function deleteStudy(t,e){e&&e.stopPropagation();const o=appState.studies[t];NotificationSystem.showConfirm("Delete Study Plan?",`Are you sure you want to delete "${o.title}"?`,`deleteStudyConfirmed(${t})`)}function deleteStudyConfirmed(t){appState.studies.splice(t,1),saveData(),SoundSystem.playSuccessSound(),NotificationSystem.showSuccess("Study plan deleted!"),NotificationSystem.hide(),renderHome()}function renderSettings(){document.getElementById("page-title").textContent="Settings";const t=appState.darkMode?"checked":"",e=SoundSystem.bgmEnabled?"checked":"";document.getElementById("content").innerHTML=`<div class="settings-item"><div><h3 style="margin: 0;">Background Music</h3><p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #999;">Toggle background music</p></div><label class="toggle"><input type="checkbox" id="bgmToggle" ${e}><span class="toggle-slider"></span></label></div><div class="settings-item"><div><h3 style="margin: 0;">Dark Mode</h3><p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #999;">Toggle dark theme</p></div><label class="toggle"><input type="checkbox" id="darkModeToggle" ${t}><span class="toggle-slider"></span></label></div><div class="settings-item"><button class="btn btn-secondary" onclick="exportData()" style="width: 100%; margin: 0;">üì• Export Data</button></div><div class="settings-item"><button class="btn btn-secondary" onclick="importData()" style="width: 100%; margin: 0;">üì§ Import Data</button></div><div class="settings-item"><h3 style="margin: 0;">About</h3><p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #999;">Edu Guide v1.2 by Zabrixa Tech</p></div>`,document.getElementById("bgmToggle").addEventListener("change",function(){SoundSystem.bgmEnabled=this.checked,localStorage.setItem("bgmEnabled",this.checked),SoundSystem.bgmEnabled?SoundSystem.playBGM():SoundSystem.stopBGM(),SoundSystem.playButtonSound()}),document.getElementById("darkModeToggle").addEventListener("change",function(){appState.darkMode=this.checked,applyDarkMode()})}function exportData(){const t=JSON.stringify(appState.studies,null,2),e=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download="edu-guide-backup-"+new Date().toISOString().split("T")[0]+".json",n.click(),URL.revokeObjectURL(o),SoundSystem.playSuccessSound(),NotificationSystem.showSuccess("Data exported successfully!")}function importData(){const t=document.createElement("input");t.type="file",t.accept="application/json",t.onchange=function(e){const o=e.target.files[0],n=new FileReader;n.readAsText=function(t){this.onload=function(e){try{const t=JSON.parse(e.target.result);if(Array.isArray(t)||window.Array&&Array.isArray(t)){appState.studies=t,saveData(),renderHome(),SoundSystem.playSuccessSound(),NotificationSystem.showSuccess("Data imported successfully!")}else NotificationSystem.showError("Invalid file format!")}catch(t){NotificationSystem.showError("Error importing file!")}},t.text()},n.onload=function(e){try{const t=JSON.parse(e.target.result);if(Array.isArray(t)||window.Array&&Array.isArray(t)){appState.studies=t,saveData(),renderHome(),SoundSystem.playSuccessSound(),NotificationSystem.showSuccess("Data imported successfully!")}else NotificationSystem.showError("Invalid file format!")}catch(t){NotificationSystem.showError("Error importing file!")}},n.readAsText(o)},t.click()}function switchPage(t){document.querySelectorAll(".nav-btn").forEach(e=>e.classList.remove("active")),"home"===t?(document.getElementById("home-btn").classList.add("active"),renderHome()):"create"===t?(document.getElementById("plus-btn").classList.add("active"),renderCreate()):"settings"===t&&(document.getElementById("settings-btn").classList.add("active"),renderSettings())}document.addEventListener("DOMContentLoaded",function(){loadData(),hideLoadingScreen(),document.getElementById("home-btn").addEventListener("click",()=>{SoundSystem.playButtonSound(),switchPage("home")}),document.getElementById("plus-btn").addEventListener("click",()=>{SoundSystem.playButtonSound(),switchPage("create")}),document.getElementById("settings-btn").addEventListener("click",()=>{SoundSystem.playButtonSound(),switchPage("settings")}),switchPage("home")});
