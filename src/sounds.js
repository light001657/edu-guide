const SoundSystem={audioContext:null,bgmEnabled:'false'!==localStorage.getItem('bgmEnabled'),init(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)());const e=document.getElementById('bgmToggle');e&&(e.addEventListener('click',()=>this.toggleBGM()),this.updateBGMButton()),this.bgmEnabled&&this.playBGM()},playButtonSound(){this.playBeep(400,0.1,0.05)},playSuccessSound(){this.playMelody([523,659,784],[0.15,0.15,0.3],0.3)},playCompletionSound(){this.playMelody([659,784,1047],[0.1,0.15,0.4],0.4)},playErrorSound(){this.playBeep(200,0.1,0.1),setTimeout(()=>this.playBeep(150,0.1,0.05),100)},playBeep(e,t,i=0.3){'suspended'===this.audioContext.state&&this.audioContext.resume();const o=this.audioContext.createOscillator(),n=this.audioContext.createGain();o.connect(n),n.connect(this.audioContext.destination),o.frequency.value=e,o.type='sine',n.gain.setValueAtTime(i,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(0.01,this.audioContext.currentTime+t),o.start(this.audioContext.currentTime),o.stop(this.audioContext.currentTime+t)},playMelody(e,t,i=0.2){'suspended'===this.audioContext.state&&this.audioContext.resume();let o=this.audioContext.currentTime;e.forEach((e,n)=>{const s=this.audioContext.createOscillator(),c=this.audioContext.createGain();s.connect(c),c.connect(this.audioContext.destination),s.frequency.value=e,s.type='sine';const a=o+t.slice(0,n).reduce((e,t)=>e+t,0),u=t[n];c.gain.setValueAtTime(i,a),c.gain.exponentialRampToValueAtTime(0.01,a+u),s.start(a),s.stop(a+u)})},toggleBGM(){this.bgmEnabled=!this.bgmEnabled,localStorage.setItem('bgmEnabled',this.bgmEnabled),this.updateBGMButton(),this.playButtonSound(),this.bgmEnabled?this.playBGM():this.stopBGM()},playBGM(){const e=document.getElementById('bgmAudio');e&&(e.volume=0.2,e.play().catch(()=>{}))},stopBGM(){const e=document.getElementById('bgmAudio');e&&(e.pause(),e.currentTime=0)},updateBGMButton(){const e=document.getElementById('bgmToggle');e&&(this.bgmEnabled?(e.textContent='üéµ BGM On',e.classList.remove('off')):(e.textContent='üîá BGM Off',e.classList.add('off')))}},NotificationSystem={show(e,t,i='‚úÖ',o='success',n=[]){const s=document.getElementById('notification');let c='';0===n.length?c='<div class="notification-buttons"><button class="notification-btn-primary" onclick="NotificationSystem.hide()">OK</button></div>':(c='<div class="notification-buttons">',n.forEach(e=>{const t=e.primary?'notification-btn-primary':'notification-btn-secondary';c+=`<button class="${t}" onclick="${e.action}">${e.text}</button>`}),c+='</div>'),s.innerHTML=`\n            <div class="notification-content">\n                <div class="notification-icon">${i}</div>\n                <h2 class="notification-title">${e}</h2>\n                <p class="notification-message">${t}</p>\n                ${c}\n            </div>\n        `,s.classList.add('show'),'success'===o?SoundSystem.playSuccessSound():'completion'===o?SoundSystem.playCompletionSound():'error'===o&&SoundSystem.playErrorSound(),0===n.length&&setTimeout(()=>this.hide(),3e3)},hide(){const e=document.getElementById('notification');e.classList.remove('show'),e.innerHTML=''},showSuccess(e){this.show('Success!',e,'‚úÖ','success')},showCompletion(e){this.show('Great Job!',e,'üéâ','completion')},showError(e){this.show('Oops!',e,'‚ùå','error')},showConfirm(e,t,i){this.show(e,t,'‚ö†Ô∏è','info',[{text:'Cancel',primary:!1,action:'NotificationSystem.hide()'},{text:'Confirm',primary:!0,action:i}])},showTaskComplete(e){this.show('Task Complete!',`You've successfully completed "${e}"!`,'üéâ','completion',[{text:'Back to Home',primary:!0,action:'switchPage("home"); NotificationSystem.hide();'}])}};document.addEventListener('DOMContentLoaded',function(){SoundSystem.init()});
